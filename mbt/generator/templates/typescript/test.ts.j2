// Code generated by fizzbee-mbt generator; DO NOT EDIT.

import { runTests, ActionFunc } from '@fizzbee/mbt';
import { {% for role in file.roles %}{{ role.name }}Role, {% endfor %}{{ model_name }}Model } from './{{ model_base_name }}_interfaces.js';
import { new{{ model_name }}Model, getTestOptions } from './{{ model_base_name }}_adapters.js';

// Registry keyed by role type ("" means top-level model actions)
const actionRegistry = new Map<string, Map<string, ActionFunc>>([
  ['', new Map<string, ActionFunc>([
    {%- for action in file.actions %}
    {%- if action.name != "Init" %}
    ['{{ action.name }}', async (inst: any, args: any[]) => {
      return (inst as {{ model_name }}Model).action{{ action.name }}(args);
    }],
    {%- endif %}
    {%- endfor %}
  ])],
  {%- for role in file.roles %}
  ['{{ role.name }}', new Map<string, ActionFunc>([
    {%- for action in role.actions %}
    {%- if action.name != "Init" %}
    ['{{ action.name }}', async (inst: any, args: any[]) => {
      return (inst as {{ role.name }}Role).action{{ action.name }}(args);
    }],
    {%- endif %}
    {%- endfor %}
  ])],
  {%- endfor %}
]);

async function test{{ model_name }}(): Promise<void> {
  const model = new{{ model_name }}Model();
  const options = getTestOptions();

  try {
    await runTests(model, actionRegistry, options);
  } catch (error) {
    console.error('Test failed:', error);
    process.exit(1);
  }
}

// Run tests
test{{ model_name }}();
